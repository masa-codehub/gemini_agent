# 振り返りレポート (KPT)

## 評価の切り口 (4 Axes)
1. **安全性 (Safety)**
2. **効率性 (Efficiency)**
3. **コンテキスト (Context)**
4. **合意形成 (Alignment)**

## 1. K (Keep): 継続すべき成功パターン
- **[Efficiency]:**
  - レビュー分析スキルを適用することで、22件という大量の指摘事項を漏れなく分類し、対応方針を構造化できた。
- **[Alignment]:**
  - Copilot/Geminiによる自動レビューが、セキュリティ（一時ファイル、envsubst）や運用の非効率（不要なジョブ起動）を的確に指摘した。

## 2. P (Problem): 構造的な阻害要因
- **[Safety]:**
  - 一時ファイルの固定名使用や、`envsubst` による広範な変数展開など、シェルスクリプトのベストプラクティスが徹底されていなかった。
- **[Context]:**
  - `AGENT_ROLE` とプロンプト内のロール記述の不一致が発生し、SSOTの参照先がブレるリスクがあった。
- **[Alignment]:**
  - 「分析と提案」を行うボットに対し、「修正を実行する」という過剰な権限/指示を与えていた。

## 3. T (Try): 具体的な改善策と資産化
- **立案された仮説:**
  - **実証的:** 指摘された修正（一意なファイル名、変数のホワイトリスト、ロールの統一）を即座に反映する。
  - **飛躍的:** ワークフロー間の `AGENT_ROLE` マッピングを共通化する（例: `metadata-logic-spec.md` での定義）。
- **選択された改善策:**
  - 実証的な修正を優先し、ボットの役割を「提案」に限定するように指示を厳格化する。

### 資産化アクション
- **具体的な手順/Issue案:**
  - [ ] ワークフロー、スクリプト、プロンプトの修正。
  - [ ] `coding-guidelines.md` に「シェルスクリプト作成時の安全策（mktemp, envsubst制限）」を追記。
